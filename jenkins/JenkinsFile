pipeline{
    agent any
    stages {
        stage('Git Checkout')
        {
            steps {
                git branch: 'main', url: 'https://gitlab.com/LINKBR/erick.git'
            }
        }
        stage('Docker Up') {
                    steps {
                        bat """docker run -d -p 4444:4444 -p 7900:7900 --shm-size="2g" --name PernambucanasDocker selenium/standalone-firefox"""
                    }
                }
        stage('Tests') {
                    steps{
                        script{
                            try{
                            dir('AutomacaoPernambucanasSeleniumGrid') {
                                bat """mvn clean install"""
                            }
                            }catch (Throwable exc) {
            						echo 'Testing Failed!'
            						echo 'Exception message: ' + exc.getMessage()
            						currentBuild.result = 'UNSTABLE'
                            }
                        }
                    }
                }
        stage('Docker Down'){
                    steps {
                        bat "docker stop PernambucanasDocker"
                        bat "docker rm PernambucanasDocker"
                    }
                }
    }
}